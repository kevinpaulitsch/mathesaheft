<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>GB English Trainer â€“ More! 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#eef3ff}
.box{max-width:420px;margin:30px auto;background:#fff;
padding:20px;border-radius:12px}
select,button,input{width:100%;padding:10px;margin-top:10px}
.mc button{margin-top:6px}
</style>
</head>

<body>
<div class="box">
<h2>GB English Trainer â€“ More! 1</h2>

<select id="unitSelect">
  <option value="all">â­ Alle Units gemischt</option>
  <option value="1">Unit 1</option>
  <option value="2">Unit 2</option>
  <option value="3">Unit 3</option>
  <option value="4">Unit 4</option>
  <option value="5">Unit 5</option>
  <option value="6">Unit 6</option>
  <option value="7">Unit 7</option>
</select>

<select id="contentSelect">
  <option value="vocab">ğŸ“˜ Vokabeln</option>
  <option value="grammar">ğŸ“ Grammatik</option>
</select>

<select id="directionSelect">
  <option value="de-en">Deutsch â†’ Englisch</option>
  <option value="en-de">Englisch â†’ Deutsch</option>
  <option value="mix">Gemischt</option>
</select>

<select id="exerciseSelect">
  <option value="write">âœ Schreiben</option>
  <option value="mc">ğŸ¯ Multiple Choice</option>
</select>

<button id="trainerBtn">â–¶ Trainer</button>
<button id="testBtn">ğŸ“ Test</button>
<button id="errorBtn">ğŸ” Fehler-Trainer</button>

<hr>

<div id="question"></div>
<input id="answerInput" placeholder="Antwort eingeben">
<div class="mc" id="mcBox"></div>
<button onclick="checkAnswer()">OK</button>
</div>

<script src="vocab.js"></script>
<script src="grammar.js"></script>

<script>
let mode="trainer",current=null,wrong=[];

/* Levenshtein */
function levenshtein(a,b){
const m=Array.from({length:a.length+1},()=>Array(b.length+1).fill(0));
for(let i=0;i<=a.length;i++)m[i][0]=i;
for(let j=0;j<=b.length;j++)m[0][j]=j;
for(let i=1;i<=a.length;i++)
for(let j=1;j<=b.length;j++)
m[i][j]=Math.min(m[i-1][j]+1,m[i][j-1]+1,
m[i-1][j-1]+(a[i-1]==b[j-1]?0:1));
return m[a.length][b.length];
}

trainerBtn.onclick=()=>{mode="trainer";start()}
testBtn.onclick=()=>{mode="test";start()}
errorBtn.onclick=()=>{mode="error";start()}

answerInput.addEventListener("keydown",e=>{
if(e.key==="Enter")checkAnswer()
})

function start(){
let unit=unitSelect.value;
let type=contentSelect.value;
let list;

if(mode==="error"){
list=wrong;
if(!list.length){alert("Keine Fehler ğŸ‘");return;}
}else{
list=type==="vocab"
? getVocabForUnit(unit)
: getGrammarForUnit(unit);
}

current=list[Math.floor(Math.random()*list.length)];
show();
}

function show(){
answerInput.value="";
mcBox.innerHTML="";

if(contentSelect.value==="grammar"){
question.innerText=current.q;
current.correct=current.a;
}else{
let dir=directionSelect.value;
if(dir==="mix")dir=Math.random()>0.5?"de-en":"en-de";
if(dir==="de-en"){
question.innerText="Ãœbersetze: "+current.de;
current.correct=current.en;
}else{
question.innerText="Ãœbersetze: "+current.en;
current.correct=current.de;
}
}

if(exerciseSelect.value==="mc")buildMC();
}

function buildMC(){
let opts=[current.correct];
while(opts.length<4){
let src=contentSelect.value==="vocab"
? getVocabForUnit("all")
: getGrammarForUnit("all");
let r=src[Math.floor(Math.random()*src.length)];
let v=r.en||r.a;
if(!opts.includes(v))opts.push(v);
}
opts.sort(()=>Math.random()-0.5);
opts.forEach(o=>{
let b=document.createElement("button");
b.innerText=o;
b.onclick=()=>check(o);
mcBox.appendChild(b);
});
}

function checkAnswer(){check(answerInput.value)}

function check(val){
let d=levenshtein(
val.trim().toLowerCase(),
current.correct.toLowerCase()
);

if(d<=1){
alert(d===0?"âœ… Richtig":"ğŸŸ¡ Fast richtig");
}else{
alert("âŒ Falsch: "+current.correct);
if(!wrong.includes(current))wrong.push(current);
}
if(mode!=="test")start();
}
</script>
</body>
</html>
