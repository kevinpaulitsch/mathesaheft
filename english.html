<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>GB English Trainer â€“ More! 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="vocab.js"></script>
<script src="grammar.js"></script>

<style>
body { font-family: Arial; background:#eef2ff; }
.box { max-width:420px; margin:20px auto; background:#fff; padding:20px; border-radius:12px; }
button, select, input { width:100%; padding:10px; margin:6px 0; font-size:16px; }
.mc { background:#e0e7ff; margin:6px 0; }
</style>
</head>

<body>
<div class="box">

<h2>GB English Trainer â€“ More! 1</h2>

<select id="unit">
  <option value="all">â­ Alle Units gemischt</option>
  <option value="1">Unit 1</option>
  <option value="2">Unit 2</option>
  <option value="3">Unit 3</option>
  <option value="4">Unit 4</option>
  <option value="5">Unit 5</option>
  <option value="6">Unit 6</option>
  <option value="7">Unit 7</option>
</select>

<select id="direction">
  <option value="de-en">Deutsch â†’ Englisch</option>
  <option value="en-de">Englisch â†’ Deutsch</option>
  <option value="mix">Gemischt</option>
</select>

<select id="mode">
  <option value="write">âœï¸ Schreiben</option>
  <option value="mc">ğŸ¯ Multiple Choice</option>
  <option value="grammar">ğŸ“˜ Grammatik</option>
</select>

<button onclick="startTrainer()">â–¶ï¸ Trainer</button>
<button onclick="startTest()">ğŸ“ Test</button>
<button onclick="startErrors()">ğŸ” Fehler-Trainer</button>

<hr>

<div id="question"></div>
<input id="answer" placeholder="Antwort eingeben">
<div id="choices"></div>
<button onclick="check()">OK</button>
<div id="feedback"></div>

</div>

<script>
let current, correct, wrong = [];

function allWords() {
  if (unit.value === "all")
    return Object.values(vocab).flat();
  return vocab[unit.value];
}

function levenshtein(a,b){
  if(!a||!b) return 99;
  const m=[...Array(a.length+1)].map(()=>Array(b.length+1).fill(0));
  for(let i=0;i<=a.length;i++)m[i][0]=i;
  for(let j=0;j<=b.length;j++)m[0][j]=j;
  for(let i=1;i<=a.length;i++)
    for(let j=1;j<=b.length;j++)
      m[i][j]=Math.min(
        m[i-1][j]+1,
        m[i][j-1]+1,
        m[i-1][j-1]+(a[i-1]==b[j-1]?0:1)
      );
  return m[a.length][b.length];
}

function next() {
  feedback.innerHTML="";
  answer.value="";
  choices.innerHTML="";

  if(mode.value==="grammar"){
    const list = unit.value==="all"
      ? Object.values(grammar).flat()
      : grammar[unit.value];
    current = list[Math.floor(Math.random()*list.length)];
    question.innerText = current.q;
    correct = current.a.toLowerCase();
    return;
  }

  const list = allWords();
  current = list[Math.floor(Math.random()*list.length)];
  let dir = direction.value==="mix"
    ? Math.random()<0.5?"de-en":"en-de"
    : direction.value;

  question.innerText = dir==="de-en"
    ? "Ãœbersetze: "+current.de
    : "Translate: "+current.en;

  correct = dir==="de-en"
    ? current.en.toLowerCase()
    : current.de.toLowerCase();

  if(mode.value==="mc"){
    let opts=[correct];
    while(opts.length<4){
      let w=list[Math.floor(Math.random()*list.length)];
      let o=dir==="de-en"?w.en:w.de;
      if(!opts.includes(o))opts.push(o);
    }
    opts.sort(()=>Math.random()-0.5);
    opts.forEach(o=>{
      let b=document.createElement("button");
      b.className="mc";
      b.innerText=o;
      b.onclick=()=>{answer.value=o;check();}
      choices.appendChild(b);
    });
  }
}

function check(){
  const val = answer.value.trim().toLowerCase();
  const d = levenshtein(val, correct);

  if(d===0){
    feedback.innerHTML="âœ… Richtig";
  } else if(d===1){
    feedback.innerHTML="ğŸŸ¡ Fast richtig";
  } else {
    feedback.innerHTML="âŒ Falsch â†’ "+correct;
    wrong.push(current);
  }
  setTimeout(next,800);
}

answer.addEventListener("keydown",e=>{
  if(e.key==="Enter")check();
});

function startTrainer(){ wrong=[]; next(); }
function startTest(){ wrong=[]; next(); }
function startErrors(){ vocab[0]=wrong; unit.value=0; next(); }

</script>
</body>
</html>
