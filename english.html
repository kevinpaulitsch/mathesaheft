<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>English Vocab Trainer â€“ More! 1</title>
<script src="vocab.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #eef2ff;
  padding: 10px;
}
.card {
  max-width: 520px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 14px;
}
h2 { text-align: center; }

select, input, button {
  width: 100%;
  padding: 12px;
  margin-top: 8px;
  font-size: 16px;
}

button { cursor: pointer; }

#mcArea button {
  margin-top: 6px;
}

.correct { color: green; font-weight: bold; }
.wrong { color: red; font-weight: bold; }

.small {
  font-size: 14px;
  color: #555;
  text-align: center;
}
</style>
</head>

<body>

<div class="card">
<h2>ğŸ‡¬ğŸ‡§ English Trainer â€“ More! 1</h2>

<!-- Unit -->
<select id="unitSelect"></select>

<!-- Richtung -->
<select id="direction">
  <option value="de-en">Deutsch â†’ Englisch</option>
  <option value="en-de">Englisch â†’ Deutsch</option>
  <option value="mixed">ğŸ”€ Gemischt</option>
</select>

<!-- Eingabeart -->
<select id="modeSelect">
  <option value="write">âœï¸ Schreiben</option>
  <option value="mc">ğŸŸ¦ Multiple Choice</option>
</select>

<!-- Lernmodus -->
<button onclick="setMode('trainer')">ğŸ“˜ Trainer</button>
<button onclick="setMode('test')">ğŸ“ Test</button>
<button onclick="setMode('errors')">ğŸ” Fehler-Trainer</button>

<hr>

<p id="question"></p>

<input id="answer" placeholder="Antwort eingeben">

<div id="mcArea" style="display:none">
  <button onclick="choose(this)"></button>
  <button onclick="choose(this)"></button>
  <button onclick="choose(this)"></button>
  <button onclick="choose(this)"></button>
</div>

<button onclick="check()">OK</button>

<p id="feedback"></p>
<p class="small" id="score"></p>
</div>

<script>
let words = [];
let errorWords = [];
let current;
let score = 0;
let asked = 0;
let mode = "trainer";

const unitSelect = document.getElementById("unitSelect");
const direction = document.getElementById("direction");
const modeSelect = document.getElementById("modeSelect");
const q = document.getElementById("question");
const a = document.getElementById("answer");
const f = document.getElementById("feedback");
const s = document.getElementById("score");
const mcArea = document.getElementById("mcArea");

/* ---------- Units ---------- */
let allOpt = document.createElement("option");
allOpt.value = "all";
allOpt.textContent = "â­ Alle Units gemischt";
unitSelect.appendChild(allOpt);

for (let u in VOCAB) {
  let o = document.createElement("option");
  o.value = u;
  o.textContent = VOCAB[u].title;
  unitSelect.appendChild(o);
}

/* ---------- Start ---------- */
function setMode(m) {
  mode = m;
  score = 0;
  asked = 0;
  start();
}

function start() {
  words = [];
  errorWords = [];

  if (mode === "errors") {
    if (window._errors && window._errors.length > 0) {
      errorWords = [...window._errors];
      words = errorWords;
    } else {
      q.textContent = "ğŸ‰ Keine Fehler vorhanden!";
      return;
    }
  } else {
    if (unitSelect.value === "all") {
      for (let u in VOCAB) words = words.concat(VOCAB[u].words);
    } else {
      words = [...VOCAB[unitSelect.value].words];
    }
    window._errors = [];
  }
  next();
}

/* ---------- NÃ¤chste Frage ---------- */
function next() {
  if (words.length === 0) {
    q.textContent = "ğŸ‰ Alles geschafft!";
    return;
  }

  current = words[Math.floor(Math.random() * words.length)];
  f.textContent = "";
  a.value = "";

  let dir = direction.value;
  let askDe = true;

  if (dir === "mixed") askDe = Math.random() < 0.5;
  else if (dir === "en-de") askDe = false;

  current.askDe = askDe;

  q.textContent = askDe
    ? "Ãœbersetze: " + current.de
    : "Translate: " + current.en;

  if (modeSelect.value === "mc") {
    a.style.display = "none";
    mcArea.style.display = "block";
    setupMC();
  } else {
    a.style.display = "block";
    mcArea.style.display = "none";
    a.focus();
  }
}

/* ---------- Schreiben ---------- */
function check() {
  if (modeSelect.value === "mc") return;

  asked++;
  let correct = current.askDe ? current.en : current.de;

  if (a.value.trim().toLowerCase() === correct.toLowerCase()) {
    f.textContent = "âœ” Richtig";
    f.className = "correct";
    score++;
    removeFromErrors();
  } else {
    f.textContent = "âœ– Richtig wÃ¤re: " + correct;
    f.className = "wrong";
    addError();
  }

  s.textContent = `Punkte: ${score} / ${asked}`;
  setTimeout(next, 800);
}

/* ---------- ENTER ---------- */
a.addEventListener("keydown", e => {
  if (e.key === "Enter") check();
});

/* ---------- Multiple Choice ---------- */
function setupMC() {
  let correct = current.askDe ? current.en : current.de;
  let answers = [correct];

  while (answers.length < 4) {
    let r = current.askDe
      ? words[Math.floor(Math.random() * words.length)].en
      : words[Math.floor(Math.random() * words.length)].de;
    if (!answers.includes(r)) answers.push(r);
  }

  answers.sort(() => Math.random() - 0.5);

  [...mcArea.children].forEach((btn, i) => {
    btn.textContent = answers[i];
    btn.className = "";
  });
}

function choose(btn) {
  asked++;
  let correct = current.askDe ? current.en : current.de;

  if (btn.textContent === correct) {
    btn.className = "correct";
    score++;
    removeFromErrors();
  } else {
    btn.className = "wrong";
    addError();
  }

  s.textContent = `Punkte: ${score} / ${asked}`;
  setTimeout(next, 800);
}

/* ---------- Fehlerverwaltung ---------- */
function addError() {
  window._errors = window._errors || [];
  if (!window._errors.includes(current)) {
    window._errors.push(current);
  }
}

function removeFromErrors() {
  if (window._errors) {
    window._errors = window._errors.filter(w => w !== current);
  }
}
</script>

</body>
</html>
